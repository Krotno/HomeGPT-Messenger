<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             BackgroundColor="{DynamicResource BackgroundColor}"
             x:Class="HomeGPT_Messenger.MainPage" Padding="0">
    <Grid>
        <Grid RowDefinitions="48,*,auto">
            <Grid Grid.Row="0" BackgroundColor="{DynamicResource BackgroundColor}">
                <Button Grid.Column="0" Text="☰" Margin="0,16,0,0" Clicked="OnMenuButtonClicked" HorizontalOptions="Start" FontSize="{DynamicResource AppFontSize}"
                        BackgroundColor="{DynamicResource ButtonBackground}" TextColor="{DynamicResource ButtonTextColor}"/>

                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" HorizontalOptions="Center">
                    <Label x:Name="ChatNameLabel" Text="Имя чата" FontSize="{DynamicResource AppFontSize}"
                           TextColor="{DynamicResource TextColor}" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label x:Name="ChatStatusLabel" Text="Готов" FontSize="{DynamicResource AppFontSize}"
                           TextColor="{DynamicResource TimeColor}" HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Grid>

            <ScrollView x:Name="MessagesScrollView" Grid.Row="1" Margin="0,0,0,0">
                <VerticalStackLayout x:Name="MessagesLayout" Spacing="8" Padding="10">
                    <BoxView x:Name="ChatBottomAnchor" HeightRequest="1"/>
                </VerticalStackLayout>
            </ScrollView>

            <Grid Grid.Row="2" ColumnDefinitions="*,Auto" Padding="10" BackgroundColor="{DynamicResource InputBackground}">
                <Entry x:Name="InputEntry"
                       Placeholder="Type your message...."
                       TextColor="{DynamicResource TextColor}"
                       BackgroundColor="{DynamicResource InputBackground}"
                       Completed="InputEntry_Completed"
                       TextChanged="InputEntry_TextChanged"
                       FontSize="{DynamicResource AppFontSize}"/>
                <Button Grid.Column="1" Text="Send" x:Name="SendButton" Clicked="OnSendClicked" FontSize="{DynamicResource AppFontSize}"
                        BackgroundColor="{DynamicResource ButtonBackground}" TextColor="{DynamicResource ButtonTextColor}"/>
            </Grid>
        </Grid>

        <BoxView x:Name="MenuOverlay" IsVisible="{Binding Source={x:Reference SideMenu}, Path=IsVisible}"
                 BackgroundColor="{DynamicResource MenuOverlayColor}" InputTransparent="False">
            <BoxView.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnMenuOverlayTapped"/>
            </BoxView.GestureRecognizers>
        </BoxView>

        <Grid x:Name="SideMenu"
              IsVisible="False"
              BackgroundColor="{DynamicResource MenuBackground}"
              WidthRequest="200"
              VerticalOptions="Fill"
              HorizontalOptions="Start"
              ZIndex="100"
              Margin="0,0,0,0">
            <VerticalStackLayout Padding="16,32">
                <Button Text="Чаты" Clicked="OnChatsClicked" Margin="10" BackgroundColor="{DynamicResource ButtonBackground}"
                        TextColor="{DynamicResource ButtonTextColor}" FontSize="{DynamicResource AppFontSize}"/>
                <Button Text="Настройки" Clicked="OnSettingsClicked" Margin="10" BackgroundColor="{DynamicResource ButtonBackground}" 
                        TextColor="{DynamicResource ButtonTextColor}" FontSize="{DynamicResource AppFontSize}"/>
            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>
